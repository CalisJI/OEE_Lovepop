"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4074],{5336:(ne,K,n)=>{n.d(K,{P:()=>D});var l=n(27702),t=n(25111),B=n(28580),V=n(73453),x=n(15758),A=n(63064);const P=()=>(0,A.getGrafanaSearcher)().getSortOptions();function D({onChange:p,value:O,placeholder:I,filter:N,getSortOptions:F,isClearable:H}){const Q=(0,t.Z)(async()=>{const Z=await(F??P)();return N?Z.filter(U=>N.includes(U.value)):Z},[F,N]);if(Q.loading)return null;const T=!!(O?.includes("desc")||O?.startsWith("-"));return l.createElement(B.Ph,{key:O,width:28,onChange:p,value:Q.value?.find(Z=>Z.value===O)??null,options:Q.value,"aria-label":"Sort",placeholder:I??`Sort (Default ${x.yw.label})`,prefix:l.createElement(V.J,{name:T?"sort-amount-down":"sort-amount-up"}),isClearable:H})}},31279:(ne,K,n)=>{n.d(K,{b:()=>V});var l=n(27702),t=n(69966),B=n(75340);class V{constructor(P){this._subject=new t.x,this._state=P}useState(){return x(this)}get state(){return this._state}setState(P){this._state={...this._state,...P},this._subject.next(this._state)}subscribeToState(P){return this._subject.subscribe(P)}}function x(A){const P=(0,B.N)();return(0,l.useEffect)(()=>{const D=A.subscribeToState({next:P});return()=>D.unsubscribe()},[A,P]),A.state}},11297:(ne,K,n)=>{n.d(K,{p:()=>P});var l=n(27702),t=n(60426),B=n(3613),V=n(21323),x=n(65322),A=n(50837);const P=({onConfirm:D,onDismiss:p,selectedItems:O,...I})=>{const[N,F]=(0,l.useState)(!1),H=async()=>{F(!0);try{await D(),F(!1),p()}catch{F(!1)}};return l.createElement(B.s,{body:l.createElement(l.Fragment,null,l.createElement(V.x,{element:"p"},l.createElement(x.cC,{i18nKey:"browse-dashboards.action.delete-modal-text"},"This action will delete the following content:")),l.createElement(A.X,{selectedItems:O}),l.createElement(t.T,{v:2})),confirmationText:"Delete",confirmText:N?(0,x.t)("browse-dashboards.action.deleting","Deleting..."):(0,x.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:p,onConfirm:H,title:(0,x.t)("browse-dashboards.action.delete-modal-title","Delete"),...I})}},78222:(ne,K,n)=>{n.d(K,{_:()=>I});var l=n(27702),t=n(60426),B=n(13741),V=n(63439),x=n(22209),A=n(66670),P=n(21323),D=n(74729),p=n(65322),O=n(50837);const I=({onConfirm:N,onDismiss:F,selectedItems:H,...Q})=>{const[T,Z]=(0,l.useState)(),[U,w]=(0,l.useState)(!1),ce=Object.keys(H.folder).filter(de=>H.folder[de]),ie=async()=>{if(T!==void 0){w(!0);try{await N(T),w(!1),F()}catch{w(!1)}}};return l.createElement(B.u,{title:(0,p.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:F,...Q},ce.length>0&&l.createElement(V.b,{severity:"info",title:(0,p.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),l.createElement(P.x,{element:"p"},l.createElement(p.cC,{i18nKey:"browse-dashboards.action.move-modal-text"},"This action will move the following content:")),l.createElement(O.X,{selectedItems:H}),l.createElement(t.T,{v:3}),l.createElement(x.g,{label:(0,p.t)("browse-dashboards.action.move-modal-field-label","Folder name")},l.createElement(D.E,{value:T,excludeUIDs:ce,onChange:Z})),l.createElement(B.u.ButtonRow,null,l.createElement(A.zx,{onClick:F,variant:"secondary",fill:"outline"},l.createElement(p.cC,{i18nKey:"browse-dashboards.action.cancel-button"},"Cancel")),l.createElement(A.zx,{disabled:T===void 0||U,onClick:ie,variant:"primary"},U?(0,p.t)("browse-dashboards.action.moving","Moving..."):(0,p.t)("browse-dashboards.action.move-button","Move"))))}},72760:(ne,K,n)=>{n.d(K,{A:()=>U});var l=n(27702),t=n(86312),B=n(26129),V=n(89746),x=n(79655),A=n(80434),P=n(66670),D=n(73453),p=n(14574),O=n(1541),I=n(66574),N=n(65322),F=n(18771),H=n(43620),Q=n(67572),T=n(11297),Z=n(78222);function U({folder:w}){const[ce,ie]=(0,l.useState)(!1),[de,se]=(0,l.useState)(!1),[Pe]=(0,Q.OH)(),[we]=(0,Q.yC)(),q=I.contextSrv.hasPermission(F.AccessControlAction.FoldersPermissionsRead),ue=I.contextSrv.hasPermission(F.AccessControlAction.FoldersPermissionsWrite),_=I.contextSrv.hasPermission(F.AccessControlAction.FoldersWrite),b=I.contextSrv.hasPermission(F.AccessControlAction.FoldersDelete),ve=async j=>{await Pe({folder:w,destinationUID:j}),(0,t.ff)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Ee=async()=>{await we(w),(0,t.ff)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:j}=w,Ce=j&&j.length?j[j.length-1].url:"/dashboards";B.E1.push(Ce)},he=()=>{I.h$.publish(new H.Dn({component:Z._,props:{selectedItems:{folder:{[w.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:ve}}))},pe=()=>{I.h$.publish(new H.Dn({component:T.p,props:{selectedItems:{folder:{[w.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Ee}}))},ye=(0,N.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),X=(0,N.t)("browse-dashboards.folder-actions-button.move","Move"),G=(0,N.t)("browse-dashboards.folder-actions-button.delete","Delete"),R=l.createElement(V.v,null,q&&l.createElement(x.s,{onClick:()=>se(!0),label:ye}),_&&l.createElement(x.s,{onClick:he,label:X}),b&&l.createElement(x.s,{destructive:!0,onClick:pe,label:G}));return!q&&!_&&!b?null:l.createElement(l.Fragment,null,l.createElement(A.L,{overlay:R,onVisibleChange:ie},l.createElement(P.zx,{variant:"secondary"},l.createElement(N.cC,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions"},"Folder actions"),l.createElement(D.J,{name:ce?"angle-up":"angle-down"}))),de&&l.createElement(p.d,{title:(0,N.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:w.title,scrollableContent:!0,onClose:()=>se(!1),size:"md"},l.createElement(O.P,{resource:"folders",resourceId:w.uid,canSetPermissions:ue})))}},18201:(ne,K,n)=>{n.r(K),n.d(K,{DashboardListPageFeatureToggle:()=>Ne,default:()=>$a});var l=n(42844),t=n(27702),B=n(25111),V=n(94469),x=n(34667),A=n(26129),P=n(44644),D=n(55925),p=n(66310),O=n(33716),I=n(18771),N=n(40127),F=n(89949),H=n(31279),Q=n(56812),T=n(15758),Z=n(46430),U=n(63064),w=n(14172);const ce=e=>e?!!(e.query||e.tag?.length>0||e.starred||e.sort):!1,ie=(e="General")=>`${T.qi}.${e.toLowerCase()}`,de=e=>{const a=Object.entries(e).reduce((s,[r,c])=>{if(c){if(r==="tag"&&!Array.isArray(c))return{...s,tag:[c]}}else return s;return{...s,[r]:c}},{});if(e.folder){const s=`folder:${e.folder}`;return{...a,query:`${s} ${(a.query??"").replace(s,"")}`}}return{...a}},se={query:"",tag:[],starred:!1,layout:w.A.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search"},Pe={sort:null,starred:null,query:null,tag:null,layout:null};class we extends H.b{constructor(){super(...arguments),this.updateLocation=(0,F.debounce)(a=>A.E1.partial(a,!0),300),this.doSearchWithDebounce=(0,F.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...Pe})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(s=>s!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const s=a.currentTarget.checked;this.setStateAndDoSearch({starred:s})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSortChange=a=>{a?localStorage.setItem(T.qb,a):localStorage.removeItem(T.qb),this.state.layout===w.A.Folders?this.setStateAndDoSearch({sort:a,layout:w.A.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(T.rh,a),this.state.sort&&a===w.A.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),Q.Z.set(T.to,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,U.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,Z.OY)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})},this.onReportSearchUsage=()=>{(0,Z.Qw)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels})}}initStateFromUrl(a,s=!0){const r=de(A.E1.getSearchObject());(r.query||r.datasource||r.panel_type)&&(r.layout=w.A.List),q.setState({...se,...r,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search"}),s&&this.doSearch()}setStateAndDoSearch(a){const s=a.sort||this.state.sort||localStorage.getItem(T.qb)||void 0;this.setState({sort:s,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.doSearchWithDebounce()}hasSearchFilters(){return this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels};(0,Z.Jy)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const s=(0,U.getGrafanaSearcher)(),r=Date.now();(this.state.starred?s.starred(this.lastQuery):s.search(this.lastQuery)).then(o=>{r>this.lastSearchTimestamp&&(this.setState({result:o,loading:!1}),this.lastSearchTimestamp=r)}).catch(o=>{(0,Z.TP)(this.state.eventTrackingNamespace,{...a,error:o?.message}),this.setState({loading:!1})})}}let q;function ue(){if(!q){const a=localStorage.getItem(T.rh)??se.layout;let s=Q.Z.getBool(T.to,!0);s&&(s=!1),q=new we({...se,layout:a,includePanels:s})}return q}function _(){const e=ue();return[e.useState(),e]}var b=n(65322);function ve(e=!1){return e?(0,b.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,b.t)("search.search-input.placeholder","Search for dashboards and folders")}function Ee(){return(0,b.t)("search.dashboard-actions.new-dashboard","New dashboard")}function he(){return(0,b.t)("search.dashboard-actions.new-folder","New folder")}function pe(){return(0,b.t)("search.dashboard-actions.import","Import")}function ye(){return(0,b.t)("search.dashboard-actions.new","New")}var X=n(67572),G=n(86312),R=n(66670),j=n(5933),Ce=n(43620),$=n(1631),ut=n(11297),ht=n(78222);function mt(){const e=(0,p.wW)(gt),a=(0,I.useDispatch)(),s=(0,$.m2)(),[r]=(0,X.zu)(),[c]=(0,X.jL)(),[,o]=_(),i=o.hasSearchFilters(),d=()=>{a((0,$.u6)({isSelected:!1,folderUID:void 0})),i&&o.doSearchWithDebounce()},u=async()=>{await r({selectedItems:s}),Be("delete",s),d()},m=async S=>{await c({selectedItems:s,destinationUID:S}),Be("move",s),d()},h=()=>{j.Z.publish(new Ce.Dn({component:ht._,props:{selectedItems:s,onConfirm:m}}))},g=()=>{j.Z.publish(new Ce.Dn({component:ut.p,props:{selectedItems:s,onConfirm:u}}))};return t.createElement("div",{className:e.row,"data-testid":"manage-actions"},t.createElement(R.zx,{onClick:h,variant:"secondary"},t.createElement(b.cC,{i18nKey:"browse-dashboards.action.move-button"},"Move")),t.createElement(R.zx,{onClick:g,variant:"destructive"},t.createElement(b.cC,{i18nKey:"browse-dashboards.action.delete-button"},"Delete")))}const gt=e=>({row:(0,l.css)({display:"flex",flexDirection:"row",gap:e.spacing(1),marginBottom:e.spacing(2)})}),ft={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function Be(e,a){const s=Object.keys(a.dashboard).filter(c=>a.dashboard[c]),r=Object.keys(a.folder).filter(c=>a.folder[c]);(0,G.ff)(ft[e],{item_counts:{folder:r.length,dashboard:s.length},source:"tree_actions"})}var oe=n(64022),ee=n(83967),vt=n(40705),Et=n(5336),pt=n(1041);function yt(){return[{value:w.A.Folders,icon:"folder",description:(0,b.t)("search.actions.view-as-folders","View by folders")},{value:w.A.List,icon:"list-ul",description:(0,b.t)("search.actions.view-as-list","View as list")}]}function We(e){const a=e.layout??w.A.Folders;return a===w.A.Folders&&(e.query||e.sort||e.starred||e.tag.length>0)?w.A.List:a}const Ie=({onLayoutChange:e,onSortChange:a,onStarredFilterChange:s=()=>{},onTagFilterChange:r,getTagOptions:c,getSortOptions:o,sortPlaceholder:i,onDatasourceChange:d,onPanelTypeChange:u,onSetIncludePanels:m,state:h,showStarredFilter:g,hideLayout:S})=>{const M=(0,p.wW)(Ue),f=We(h),E=h.query||h.datasource||h.panel_type?[w.A.Folders]:[];return t.createElement("div",{className:M.actionRow},t.createElement(oe.Lh,{spacing:"md",width:"auto"},t.createElement(pt.D,{isClearable:!1,tags:h.tag,tagOptions:c,onChange:r}),x.config.featureToggles.panelTitleSearch&&t.createElement(ee.X,{"data-testid":"include-panels",disabled:f===w.A.Folders,value:h.includePanels,onChange:()=>m(!h.includePanels),label:(0,b.t)("search.actions.include-panels","Include panels")}),g&&t.createElement("div",{className:M.checkboxWrapper},t.createElement(ee.X,{label:(0,b.t)("search.actions.starred","Starred"),onChange:s,value:h.starred})),h.datasource&&t.createElement(R.zx,{icon:"times",variant:"secondary",onClick:()=>d(void 0)},t.createElement(b.cC,{i18nKey:"search.actions.remove-datasource-filter"},"Datasource: ",{datasource:h.datasource})),h.panel_type&&t.createElement(R.zx,{icon:"times",variant:"secondary",onClick:()=>u(void 0)},"Panel: ",h.panel_type)),t.createElement(oe.Lh,{spacing:"md",width:"auto"},!S&&t.createElement(vt.S,{options:yt(),disabledOptions:E,onChange:e,value:f}),t.createElement(Et.P,{onChange:v=>a(v?.value),value:h.sort,getSortOptions:o,placeholder:i||(0,b.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})))};Ie.displayName="ActionRow";const Ue=e=>({actionRow:(0,l.css)`
      display: none;

      ${e.breakpoints.up("md")} {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-bottom: ${e.spacing(2)};
        width: 100%;
      }
    `,checkboxWrapper:(0,l.css)`
      label {
        line-height: 1.2;
      }
    `});function Ct(){const[e,a]=_();return t.createElement("div",null,t.createElement(Ie,{hideLayout:!0,showStarredFilter:!0,state:e,getTagOptions:a.getTagOptions,getSortOptions:(0,U.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,U.getGrafanaSearcher)().sortPlaceholder,includePanels:e.includePanels??!1,onLayoutChange:a.onLayoutChange,onStarredFilterChange:a.onStarredFilterChange,onSortChange:a.onSortChange,onTagFilterChange:a.onTagFilterChange,onDatasourceChange:a.onDatasourceChange,onPanelTypeChange:a.onPanelTypeChange,onSetIncludePanels:a.onSetIncludePanels}))}var St=n(60801),Ke=n(66970),xe=n(49079),k=n(6309),bt=n(10350),ke=n(25472),ze=n(56365),Dt=n(53933),re=n(74639);function Mt({row:{original:e},isSelected:a,onItemSelectionChange:s}){const r=(0,p.wW)(Pt),c=e.item;if(!a)return t.createElement("span",{className:r.checkboxSpacer});if(c.kind==="ui")return c.uiKind==="pagination-placeholder"?t.createElement(ee.X,{disabled:!0,value:!1}):t.createElement("span",{className:r.checkboxSpacer});const o=a(c);return t.createElement(ee.X,{"data-testid":re.wl.pages.BrowseDashbards.table.checkbox(c.uid),value:o===k.f.Selected,indeterminate:o===k.f.Mixed,onChange:i=>s?.(c,i.currentTarget.checked)})}const Pt=e=>({checkboxSpacer:(0,l.css)({paddingLeft:e.spacing(2)})});function wt({isSelected:e,onAllSelectionChange:a}){const s=e?.("$all")??k.f.Unselected;return t.createElement(ee.X,{value:s===k.f.Selected,indeterminate:s===k.f.Mixed,onChange:r=>{s===k.f.Mixed?a?.(!1):a?.(r.currentTarget.checked)}})}var It=n(57704),Ve=n(67437),Se=n(62108),Y=n(73453),xt=n(9848),Ze=n(94851),He=n(21323),te=n(6092),Qe=n(4571);const Te="md",Ge="sm";function Tt({row:{original:e},onFolderClick:a}){const s=(0,p.wW)(At),{item:r,level:c,isOpen:o}=e,i=(0,$.$H)(),d=o&&!i[r.uid],u=(0,te.J6)(e.item.kind,o);return r.kind==="ui"?t.createElement(t.Fragment,null,t.createElement(Qe.A,{level:c}),t.createElement("span",{className:s.folderButtonSpacer}),r.uiKind==="empty-folder"?t.createElement("em",{className:s.emptyText},t.createElement(He.x,{variant:"body",color:"secondary",truncate:!0},"No items")):t.createElement(It.Z,{width:200})):t.createElement(t.Fragment,null,t.createElement(Qe.A,{level:c}),r.kind==="folder"?t.createElement(Ve.h,{size:Te,className:s.chevron,onClick:()=>{a(r.uid,!o)},name:o?"angle-down":"angle-right","aria-label":o?"Collapse folder":"Expand folder"}):t.createElement("span",{className:s.folderButtonSpacer}),t.createElement("div",{className:s.iconNameContainer},d?t.createElement(Se.$,{size:Ge}):t.createElement(Y.J,{size:Ge,name:u}),t.createElement(He.x,{variant:"body",truncate:!0},r.url?t.createElement(xt.r,{onClick:()=>{(0,G.ff)("manage_dashboards_result_clicked")},href:r.url,className:s.link},r.title):r.title)))}const At=e=>({chevron:(0,l.css)({marginRight:e.spacing(1),width:(0,Ze.B)(Te)}),emptyText:(0,l.css)({overflow:"hidden"}),folderButtonSpacer:(0,l.css)({paddingLeft:`calc(${(0,Ze.B)(Te)}px + ${e.spacing(1)})`}),iconNameContainer:(0,l.css)({alignItems:"center",display:"flex",gap:e.spacing(1),overflow:"hidden"}),link:(0,l.css)({"&:hover":{textDecoration:"underline"}})});var Ae=n(86004);function Ft({row:{original:e}}){const a=(0,p.wW)(Lt),s=e.item;return s.kind==="ui"?s.uiKind==="pagination-placeholder"?t.createElement(Ae.P.Skeleton,null):null:s.tags?t.createElement(Ae.P,{className:a.tagList,tags:s.tags}):null}function Lt(e){return{tagList:(0,l.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var Ot=n(4049);const je=36,Je=36;function Nt({items:e,width:a,height:s,isSelected:r,onFolderClick:c,onAllSelectionChange:o,onItemSelectionChange:i,isItemLoaded:d,requestLoadMore:u,canSelect:m=!1}){const h=(0,t.useRef)(null),g=(0,p.wW)(Xe);(0,t.useEffect)(()=>{h.current&&h.current.resetloadMoreItemsCache(!0)},[e]);const S=(0,t.useMemo)(()=>{const W={id:"checkbox",width:0,Header:wt,Cell:Mt},z={id:"name",width:3,Header:t.createElement("span",{style:{paddingLeft:24}},t.createElement(b.cC,{i18nKey:"browse-dashboards.dashboards-tree.name-column"},"Name")),Cell:$e=>t.createElement(Tt,{...$e,onFolderClick:c})},fe={id:"tags",width:2,Header:(0,b.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:Ft};return[m&&W,z,fe].filter(Dt.fQ)},[c,m]),M=(0,bt.useTable)({columns:S,data:e},Ot._),{getTableProps:f,getTableBodyProps:E,headerGroups:v}=M,y=(0,t.useMemo)(()=>({table:M,isSelected:r,onAllSelectionChange:o,onItemSelectionChange:i}),[M,r,o,i,e]),C=(0,t.useCallback)(W=>d(W),[d]),L=(0,t.useCallback)((W,z)=>{const{parentUID:fe}=e[W];u(fe)},[u,e]);return t.createElement("div",{...f(),className:g.tableRoot,role:"table"},v.map(W=>{const{key:z,...fe}=W.getHeaderGroupProps({style:{width:a}});return t.createElement("div",{key:z,...fe,className:(0,l.cx)(g.row,g.headerRow)},W.headers.map(Re=>{const{key:$e,...Ba}=Re.getHeaderProps();return t.createElement("div",{key:$e,...Ba,role:"columnheader",className:g.cell},Re.render("Header",{isSelected:r,onAllSelectionChange:o}))}))}),t.createElement("div",{...E()},t.createElement(ze.Z,{ref:h,itemCount:e.length,isItemLoaded:C,loadMoreItems:L},({onItemsRendered:W,ref:z})=>t.createElement(ke.t7,{ref:z,height:s-je,width:a,itemCount:e.length,itemData:y,itemSize:Je,onItemsRendered:W},Rt))))}function Rt({index:e,style:a,data:s}){const r=(0,p.wW)(Xe),{table:c,isSelected:o,onItemSelectionChange:i}=s,{rows:d,prepareRow:u}=c,m=d[e];return u(m),t.createElement("div",{...m.getRowProps({style:a}),className:(0,l.cx)(r.row,r.bodyRow),"data-testid":re.wl.pages.BrowseDashbards.table.row(m.original.item.uid)},m.cells.map(h=>{const{key:g,...S}=h.getCellProps();return t.createElement("div",{key:g,...S,className:r.cell},h.render("Cell",{isSelected:o,onItemSelectionChange:i}))}))}const Xe=e=>({tableRoot:(0,l.css)({[k.w]:e.spacing(1),[e.breakpoints.up("md")]:{[k.w]:e.spacing(3)}}),row:(0,l.css)({gap:e.spacing(1)}),headerRow:(0,l.css)({backgroundColor:e.colors.background.secondary,height:je}),bodyRow:(0,l.css)({height:Je,"&:hover":{backgroundColor:e.colors.emphasize(e.colors.background.primary,.03)}}),cell:(0,l.css)({padding:e.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,l.css)({"&:hover":{textDecoration:"underline"}})});function $t({folderUID:e,width:a,height:s,canSelect:r}){const c=(0,$.zw)(e),o=(0,I.useDispatch)(),i=(0,$.Sk)(e),d=(0,$.aw)(),u=(0,$.$H)(),m=(0,t.useCallback)((f,E)=>{o((0,$.xm)({folderUID:f,isOpen:E})),E&&o((0,$.si)({parentUID:f,pageSize:xe.IV}))},[o]),h=(0,t.useCallback)((f,E)=>{o((0,$.wk)({item:f,isSelected:E}))},[o]),g=(0,t.useCallback)(f=>{if(f==="$all"){if(d.$all)return k.f.Selected;for(const y of Object.values(d))if(typeof y!="boolean"){for(const C in y)if(y[C])return k.f.Mixed}return k.f.Unselected}return d[f.kind][f.uid]?k.f.Selected:Ye(f,u,d)?k.f.Mixed:k.f.Unselected},[d,u]),S=(0,t.useCallback)(f=>{const E=i[f];if(!E)return!1;const v=E.item;return!(v.kind==="ui"&&v.uiKind==="pagination-placeholder")},[i]),M=(0,$.D$)();return c==="fulfilled"&&i.length===0?t.createElement("div",{style:{width:a}},r?t.createElement(Ke.Z,{title:e?"This folder doesn't have any dashboards yet":"No dashboards yet. Create your first!",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:e?`dashboard/new?folderUid=${e}`:"dashboard/new",proTip:e&&"Add/move dashboards to your folder at ->",proTipLink:e&&"dashboards",proTipLinkTitle:e&&"Browse dashboards",proTipTarget:""}):t.createElement(St._,{callToActionElement:t.createElement("span",null,"This folder is empty")})):t.createElement(Nt,{canSelect:r,items:i,width:a,height:s,isSelected:g,onFolderClick:m,onAllSelectionChange:f=>o((0,$.u6)({isSelected:f,folderUID:e})),onItemSelectionChange:h,isItemLoaded:S,requestLoadMore:M})}function Ye(e,a,s){const r=a[e.uid];return r?r.items.some(c=>{const o=s[c.kind][c.uid];return o||Ye(c,a,s)}):!1}var Bt=n(7662),me=n(89746),Fe=n(79655),qe=n(80434),Wt=n(14574),Ut=n(23839),Kt=n(22209),kt=n(1128),zt=n(39345);const Vt={folderName:""};function Zt({onCancel:e,onConfirm:a}){const s=(0,b.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),r=async o=>{try{return await zt.t.validateNewFolderName(o),!0}catch(i){if(i instanceof Error)return i.message;throw i}},c=(0,b.t)("browse-dashboards.new-folder-form.name-label","Folder name");return t.createElement(Ut.l,{defaultValues:Vt,onSubmit:o=>a(o.folderName)},({register:o,errors:i})=>t.createElement(t.Fragment,null,t.createElement(Kt.g,{label:c,invalid:!!i.folderName,error:i.folderName&&i.folderName.message},t.createElement(kt.I,{id:"folder-name-input",...o("folderName",{required:s,validate:async d=>await r(d)})})),t.createElement(oe.Lh,null,t.createElement(R.zx,{variant:"secondary",fill:"outline",onClick:e},t.createElement(b.cC,{i18nKey:"browse-dashboards.new-folder-form.cancel-label"},"Cancel")),t.createElement(R.zx,{type:"submit"},t.createElement(b.cC,{i18nKey:"browse-dashboards.new-folder-form.create-label"},"Create")))))}function Ht({parentFolder:e,canCreateDashboard:a,canCreateFolder:s}){const[r,c]=(0,t.useState)(!1),o=(0,Bt.TH)(),[i]=(0,X.wo)(),[d,u]=(0,t.useState)(!1),m=async g=>{try{await i({title:g,parentUid:e?.uid});const S=e?.parents?e.parents.length+1:0;(0,G.ff)("grafana_manage_dashboards_folder_created",{is_subfolder:!!e?.uid,folder_depth:S})}finally{u(!1)}},h=t.createElement(me.v,null,a&&t.createElement(Fe.s,{label:Ee(),onClick:()=>(0,G.ff)("grafana_menu_item_clicked",{url:be("/dashboard/new",e?.uid),from:o.pathname}),url:be("/dashboard/new",e?.uid)}),s&&t.createElement(Fe.s,{onClick:()=>u(!0),label:he()}),a&&t.createElement(Fe.s,{label:pe(),onClick:()=>(0,G.ff)("grafana_menu_item_clicked",{url:be("/dashboard/import",e?.uid),from:o.pathname}),url:be("/dashboard/import",e?.uid)}));return t.createElement(t.Fragment,null,t.createElement(qe.L,{overlay:h,onVisibleChange:c},t.createElement(R.zx,null,ye(),t.createElement(Y.J,{name:r?"angle-up":"angle-down"}))),d&&t.createElement(Wt.d,{title:he(),subtitle:e?.title?`Location: ${e.title}`:void 0,scrollableContent:!0,onClose:()=>u(!1),size:"sm"},t.createElement(Zt,{onConfirm:m,onCancel:()=>u(!1)})))}function be(e,a){return a?e+"?folderUid="+a:e}var Qt=n(72760),Gt=n(27938),jt=n(32053),J=n(50230),Le=n(63419),_e=n(73153);const le=50,Jt={view:new Gt.U((0,jt.g0)({fields:[{name:"uid",display:!0,values:Array(le).fill(null)},{name:"kind",display:!0,values:Array(le).fill("dashboard")},{name:"name",display:!0,values:Array(le).fill("")},{name:"location",display:!0,values:Array(le).fill("")},{name:"tags",display:!0,values:Array(le).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:le};function Xt({width:e,height:a,canSelect:s}){const r=(0,I.useDispatch)(),c=(0,I.useSelector)(f=>f.browseDashboards.selectedItems),o=(0,$.QD)(),{keyboardEvents:i}=(0,Le.A)(),[d,u]=_(),m=d.result??Jt,h=(0,t.useCallback)((f,E)=>f?f==="*"&&E==="*"?o:f==="*"?!1:c[et(f)][E]??!1:!1,[c,o]),g=(0,t.useCallback)(()=>{r((0,$.u6)({isSelected:!1,folderUID:void 0}))},[r]),S=(0,t.useCallback)((f,E)=>{const v=!h(f,E);r((0,$.wk)({item:{kind:et(f),uid:E},isSelected:v}))},[h,r]);if(m.totalRows===0)return t.createElement("div",{style:{width:e}},t.createElement(J.Z,null,t.createElement(J.Z.Heading,null,t.createElement(b.cC,{i18nKey:"browse-dashboards.no-results.text"},"No results found for your query.")),t.createElement(J.Z.Actions,null,t.createElement(R.zx,{variant:"secondary",onClick:u.onClearSearchAndFilters},t.createElement(b.cC,{i18nKey:"browse-dashboards.no-results.clear"},"Clear search and filters")))));const M={response:m,selection:s?h:void 0,selectionToggle:s?S:void 0,clearSelection:g,width:e,height:a,onTagSelected:u.onAddTag,keyboardEvents:i,onDatasourceChange:d.datasource?u.onDatasourceChange:void 0,onClickItem:u.onSearchItemClicked};return t.createElement(_e.Q,{...M})}function et(e){switch(e){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+e)}var De=n(66574);function Oe(e,a,s){return s?De.contextSrv.hasAccessInMetadata(e,s,a):De.contextSrv.hasAccess(e,a)}function Yt(e){const a=e?e.canSave:De.contextSrv.hasEditPermissionInFolders,s=Oe(I.AccessControlAction.FoldersWrite,a,e),r=Oe(I.AccessControlAction.FoldersCreate,De.contextSrv.isEditor),c=Oe(I.AccessControlAction.DashboardsCreate,a||!!e?.canSave);return{canEditInFolder:s,canCreateDashboards:c,canCreateFolder:r}}const tt=(0,t.memo)(({match:e})=>{const{uid:a}=e.params,s=(0,I.useDispatch)(),r=(0,p.wW)(qt),[c,o]=_(),i=o.hasSearchFilters();(0,t.useEffect)(()=>{o.initStateFromUrl(a),s((0,$.u6)({isSelected:!1,folderUID:void 0}))},[s,a,o]),(0,t.useEffect)(()=>{!i&&c.result&&o.setState({result:void 0,includePanels:void 0})},[i,c.result,o]);const{data:d}=(0,X.t4)(a??X.CN),[u]=(0,X.vN)(),m=(0,t.useMemo)(()=>{if(!d)return;const v=(0,N.B1)(d),y=(0,N.Pr)(d.uid),C=v.children?.find(L=>L.id===y);return C&&(C.active=!0),v},[d]),h=(0,$.QD)(),{canEditInFolder:g,canCreateDashboards:S,canCreateFolder:M}=Yt(d),f=g&&a,E=async v=>{if(d){const y=await u({...d,title:v});if("error"in y)throw y.error}};return t.createElement(P.T,{navId:"dashboards/browse",pageNav:m,onEditTitle:f?E:void 0,actions:t.createElement(t.Fragment,null,d&&t.createElement(Qt.A,{folder:d}),(S||M)&&t.createElement(Ht,{parentFolder:d,canCreateDashboard:S,canCreateFolder:M}))},t.createElement(P.T.Contents,{className:r.pageContents},t.createElement(O.H,{placeholder:ve(c.includePanels),value:c.query,escapeRegex:!1,onChange:v=>o.onQueryChange(v)}),h?t.createElement(mt,null):t.createElement(Ct,null),t.createElement("div",{className:r.subView},t.createElement(D.Z,null,({width:v,height:y})=>i?t.createElement(Xt,{canSelect:g,width:v,height:y}):t.createElement($t,{canSelect:g,width:v,height:y,folderUID:a})))))}),qt=e=>({pageContents:(0,l.css)({display:"grid",gridTemplateRows:"auto auto 1fr",height:"100%",rowGap:e.spacing(1)}),subView:(0,l.css)({height:"100%"})});tt.displayName="BrowseDashboardsPage";const _t=tt;var ea=n(45937);const ta=e=>ea.ae.getFolderByUid(e,{withAccessControl:!0}).then(a=>{const s=(0,N.B1)(a);return s.children[0].active=!0,{folder:a,folderNav:s}});var ae=n(91368),aa=n(29956);function na(){const e=new Map;return{items:e,isSelected:(s,r)=>!!e.get(s)?.has(r)}}function sa(e,a,s,r){const c=e.items;if(r.length){const o=c.get(s);if(o){for(const i of r)a?o.add(i):o.delete(i);o.size<1&&c.delete(s)}else a&&c.set(s,new Set(r))}return{items:c,isSelected:(o,i)=>{if(i==="*"){if(o==="*"){for(const d of c.keys())if(c.get(d)?.size)return!0;return!1}return!!c.get(o)?.size}return!!c.get(o)?.has(i)}}}var oa=n(84789),ra=n(8553),la=n(62499),ge=n(12308);const at=(0,t.memo)(({onClick:e,className:a,checked:s=!1,editable:r=!1,"aria-label":c})=>r?t.createElement(ee.X,{onClick:e,className:a,value:s,"aria-label":c}):null);at.displayName="SearchCheckbox";const ca=re.wl.components.Search,ia=(e="")=>{const a=new Map([["errors","info-circle"],["views","eye"]]);return a.has(e)?a.get(e):"sort-amount-down"},nt=({item:e,isSelected:a,editable:s,onToggleChecked:r,onTagSelected:c,onClickItem:o})=>{const i=(0,p.wW)(ua),d=(0,t.useCallback)((h,g)=>{g.stopPropagation(),g.preventDefault(),c(h)},[c]),u=(0,t.useCallback)(h=>{h.stopPropagation(),r&&r(e)},[e,r]),m=x.config.featureToggles.nestedFolders?t.createElement(t.Fragment,null,t.createElement(Y.J,{name:(0,te.J6)(e.kind),"aria-hidden":!0})," ",da(e.kind)):t.createElement(t.Fragment,null,t.createElement(Y.J,{name:(0,te.J6)(e.parentKind??"folder"),"aria-hidden":!0})," ",e.parentTitle||"General");return t.createElement("div",{className:i.cardContainer},t.createElement(at,{className:i.checkbox,"aria-label":"Select dashboard",editable:s,checked:a,onClick:u}),t.createElement(J.Z,{className:i.card,"data-testid":ca.dashboardItem(e.title),href:e.url,style:{minHeight:T.CN},onClick:o},t.createElement(J.Z.Heading,null,e.title),t.createElement(J.Z.Meta,{separator:""},t.createElement("span",{className:i.metaContainer},m),e.sortMetaName&&t.createElement("span",{className:i.metaContainer},t.createElement(Y.J,{name:ia(e.sortMetaName)}),e.sortMeta," ",e.sortMetaName)),t.createElement(J.Z.Tags,null,t.createElement(Ae.P,{tags:e.tags??[],onClick:d,getAriaLabel:h=>`Filter by tag "${h}"`}))))};function da(e){switch(e){case"folder":return(0,b.t)("search.result-kind.folder","Folder");case"dashboard":return(0,b.t)("search.result-kind.dashboard","Dashboard");case"panel":return(0,b.t)("search.result-kind.panel","Panel")}}const ua=e=>({cardContainer:(0,l.css)`
      display: flex;
      align-items: center;
      margin-bottom: ${e.spacing(.75)};
    `,card:(0,l.css)`
      padding: ${e.spacing(1)} ${e.spacing(2)};
      margin-bottom: 0;
    `,checkbox:(0,l.css)({marginRight:e.spacing(1)}),metaContainer:(0,l.css)`
      display: flex;
      align-items: center;
      margin-right: ${e.spacing(1)};

      svg {
        margin-right: ${e.spacing(.5)};
      }
    `});var ha=n(91342);async function st(e,a,s=!1){if(!ge.default.featureToggles.nestedFolders)return console.error("getFolderChildren requires nestedFolders feature toggle"),[];if(!s&&!e)return await(0,xe.ry)();const c=await(0,ha.O)().search({kind:["dashboard"],query:"*",location:e||"general",limit:1e3}),o=c.view.map(d=>(0,te.f9)(d,c.view));return[...await(0,xe.ry)(e,a),...o]}async function ma(e,a){if(ge.config.featureToggles.nestedFolders)return st(e.uid,e.title);const s=e.itemsUIDs?{uid:e.itemsUIDs}:{query:"*",kind:["dashboard"],location:e.uid,sort:"name_sort",limit:1e3},r=await(0,U.getGrafanaSearcher)().search({...s,tags:a});return r.view.map(c=>(0,te.f9)(c,r.view))}const ot=({section:e,selectionToggle:a,onClickItem:s,onTagSelected:r,selection:c,renderStandaloneBody:o,tags:i})=>{const d=a!=null,u=(0,p.wW)((0,t.useCallback)(C=>ga(C,d),[d])),[m,h]=(0,oa.Z)(ie(e.title),!1),g=(0,B.Z)(async()=>!m&&!o?Promise.resolve([]):ma(e,i),[m,i]),S=()=>{h(!m)},M=C=>{if(C.preventDefault(),C.stopPropagation(),a&&c){const L=!c(e.kind,e.uid);a(e.kind,e.uid);const W=g.value??[];for(const z of W)c(z.kind,z.uid)!==L&&a(z.kind,z.uid)}},E=`section-header-label-${(0,t.useId)()}`;let v=(0,ra.iJ)(e.icon??"");v||(v=m?"folder-open":"folder");const y=()=>{if(g.value){if(g.value.length===0&&!g.loading)return t.createElement(J.Z,null,t.createElement(J.Z.Heading,null,"No results found"))}else return null;return g.value.map(C=>t.createElement(nt,{key:C.uid,item:C,onTagSelected:r,onToggleChecked:L=>a?.(L.kind,L.uid),editable:c!=null,onClickItem:s,isSelected:c?.(C.kind,C.uid)}))};return o?t.createElement("div",{className:u.folderViewResults},!g.value?.length&&g.loading?t.createElement(Se.$,{className:u.spinner}):y()):t.createElement(la.s,{headerDataTestId:re.wl.components.Search.folderHeader(e.title),contentDataTestId:re.wl.components.Search.folderContent(e.title),isOpen:m??!1,onToggle:S,className:u.wrapper,contentClassName:u.content,loading:g.loading,labelId:E,label:t.createElement(t.Fragment,null,a&&c&&t.createElement("div",{onClick:M},t.createElement(ee.X,{className:u.checkbox,value:c(e.kind,e.uid),"aria-label":(0,b.t)("search.folder-view.select-folder","Select folder")})),t.createElement("div",{className:u.icon},t.createElement(Y.J,{name:v})),t.createElement("div",{className:u.text},t.createElement("span",{id:E},e.title),e.url&&e.uid!==T.YQ&&t.createElement("a",{href:e.url,className:u.link},t.createElement("span",{className:u.separator},"|")," ",t.createElement(Y.J,{name:"folder-upload"})," ",(0,b.t)("search.folder-view.go-to-folder","Go to folder"))))},g.value&&t.createElement("ul",{className:u.sectionItems},y()))},ga=(e,a)=>{const s=e.spacing(1);return{wrapper:(0,l.css)`
      align-items: center;
      font-size: ${e.typography.size.base};
      padding: 12px;
      border-bottom: none;
      color: ${e.colors.text.secondary};
      z-index: 1;

      &:hover,
      &.selected {
        color: ${e.colors.text};
      }

      &:hover,
      &:focus-visible,
      &:focus-within {
        a {
          opacity: 1;
        }
      }
    `,sectionItems:(0,l.css)`
      margin: 0 24px 0 32px;
    `,icon:(0,l.css)`
      padding: 0 ${s} 0 ${a?0:s};
    `,folderViewResults:(0,l.css)`
      overflow: auto;
    `,text:(0,l.css)`
      flex-grow: 1;
      line-height: 24px;
    `,link:(0,l.css)`
      padding: 2px 10px 0;
      color: ${e.colors.text.secondary};
      opacity: 0;
      transition: opacity 150ms ease-in-out;
    `,separator:(0,l.css)`
      margin-right: 6px;
    `,content:(0,l.css)`
      padding-top: 0px;
      padding-bottom: 0px;
    `,spinner:(0,l.css)`
      display: grid;
      place-content: center;
      padding-bottom: 1rem;
    `,checkbox:(0,l.css)({marginRight:e.spacing(1)})}};var fa=n(3613),Me=n(77799);const va=({results:e,onDeleteItems:a,onDismiss:s})=>{const r=(0,p.wW)(Ea),c=Array.from(e.get("dashboard")??[]),o=Array.from(e.get("folder")??[]),i=o.length,d=c.length;let u="Do you want to delete the ",m;const h=d===1?"":"s",g=i===1?"":"s";i>0&&d>0?(u+=`selected folder${g} and dashboard${h}?
`,m=`All dashboards and alerts of the selected folder${g} will also be deleted`):i>0?u+=`selected folder${g} and all ${i===1?"its":"their"} dashboards and alerts?`:u+=`${d} selected dashboard${h}?`;const S=()=>{(0,Me.Fd)(o,c).then(()=>{a(),s()})},M=ge.config.featureToggles.nestedFolders&&i>0;return t.createElement(fa.s,{isOpen:!0,title:"Delete",body:t.createElement(t.Fragment,null,u," ",m&&t.createElement("div",{className:r.subtitle},m)),confirmText:"Delete",confirmationText:M?"delete":void 0,onConfirm:S,onDismiss:s})},Ea=e=>({subtitle:(0,l.css)`
    font-size: ${e.typography.fontSize}px;
    padding-top: ${e.spacing(2)};
  `});var pa=n(13741),rt=n(63439),ya=n(41482),Ca=n(73807);const lt=({results:e,onMoveItems:a,onDismiss:s})=>{const[r,c]=(0,t.useState)(null),o=(0,p.wW)(ba),i=(0,Ca.iG)(),[d,u]=(0,t.useState)(!1),m=ge.default.featureToggles.nestedFolders,h=Array.from(e.get("dashboard")??[]),g=m?Array.from(e.get("folder")??[]).filter(E=>E!==T.YQ):[],S=(0,t.useCallback)(E=>{c(E)},[c]),M=async()=>{if(r){if(m){u(!0);let E=0,v=0;if(h.length){const C=await(0,Me.ct)(h,r);E+=C.totalCount,v+=C.successCount}if(g.length){const C=await(0,Me.Jx)(g,r);E+=C.totalCount,v+=C.successCount}const y=r.title??"General";Sa(i,y,{selectedDashboardsCount:h.length,selectedFoldersCount:g.length,totalCount:E,successCount:v}),a(),u(!1),s();return}if(h.length){const E=r.title??"General";u(!0),(0,Me.ct)(h,r).then(v=>{if(v.successCount>0){const y=v.successCount===1?"":"s",C=`Dashboard${y} Moved`,L=`${v.successCount} dashboard${y} moved to ${E}`;i.success(C,L)}v.totalCount===v.alreadyInFolderCount?i.error("Error",`Dashboard already belongs to folder ${E}`):a(),u(!1),s()})}}},f=[["folder","folders",g.length],["dashboard","dashboards",h.length]].filter(([E,v,y])=>y>0).map(([E,v,y])=>`${y.toLocaleString()} ${y===1?E:v}`).join(" and ");return t.createElement(pa.u,{isOpen:!0,className:o.modal,title:m?"Move":"Choose Dashboard Folder",icon:"folder-plus",onDismiss:s},t.createElement(t.Fragment,null,t.createElement("div",{className:o.content},m&&g.length>0&&t.createElement(rt.b,{severity:"warning",title:" Moving this item may change its permissions"}),t.createElement("p",null,"Move ",f," to:"),t.createElement(ya.Fz,{allowEmpty:!0,enableCreateNew:!1,onChange:S})),t.createElement(oe.Lh,{justify:"flex-end"},t.createElement(R.zx,{variant:"secondary",onClick:s,fill:"outline"},"Cancel"),t.createElement(R.zx,{icon:d?"fa fa-spinner":void 0,variant:"primary",onClick:M},"Move"))))};function Sa(e,a,{selectedDashboardsCount:s,selectedFoldersCount:r,totalCount:c,successCount:o}){let i;const d=o===1?"":"s",u=c-o;if(s&&r?i=`Item${d}`:s?i=`Dashboard${d}`:r&&(i=`Folder${d}`),i){const m=i?.toLocaleLowerCase();c===o?e.success(`${i} moved`,`Moved ${o} ${m} to ${a}`):o===0?e.error(`Failed to move ${m}`,`Could not move ${c} ${m} due to an error`):e.warning(`Partially moved ${m}`,`Failed to move ${u} ${m} to ${a}`)}}const ba=e=>({modal:(0,l.css)`
      width: 500px;
    `,content:(0,l.css)`
      margin-bottom: ${e.spacing(3)};
    `});function Da({items:e,folder:a,onChange:s,clearSelection:r}){const c=(0,p.wW)(Ue),o=a?.canSave,i=a?o:ae.contextSrv.hasEditPermissionInFolders,d=i,m=Array.from(e.get("folder")??[]).find(y=>y===T.YQ),h=i&&!m,[g,S]=(0,t.useState)(!1),[M,f]=(0,t.useState)(!1),E=()=>{S(!0)},v=()=>{f(!0)};return t.createElement("div",{className:c.actionRow,"data-testid":"manage-actions"},t.createElement(oe.Lh,{spacing:"md",width:"auto"},t.createElement(Ve.h,{name:"check-square",onClick:r,tooltip:"Uncheck everything"}),t.createElement(R.zx,{disabled:!d,onClick:E,icon:"exchange-alt",variant:"secondary"},"Move"),t.createElement(R.zx,{disabled:!h,onClick:v,icon:"trash-alt",variant:"destructive"},"Delete")),M&&t.createElement(va,{onDeleteItems:s,results:e,onDismiss:()=>f(!1)}),g&&t.createElement(lt,{onMoveItems:s,results:e,onDismiss:()=>S(!1)}))}var Ma=n(73289),Pa=n(6872);async function wa(){if(ge.default.featureToggles.nestedFolders)return st();const e=(0,U.getGrafanaSearcher)(),a=await e.search({query:"*",kind:["folder"],sort:e.getFolderViewSort(),limit:1e3});return a.view.map(s=>(0,te.f9)(s,a.view))}const Ia=({selection:e,selectionToggle:a,onTagSelected:s,tags:r,hidePseudoFolders:c,onClickItem:o})=>{const i=(0,p.wW)(xa),d=(0,B.Z)(async()=>{const m=await wa();if(m.unshift({title:"General",url:"/dashboards",kind:"folder",uid:T.YQ}),!c){const h=await Pa.Z.getDashboardOpened();if(h.length&&m.unshift({title:"Recent",icon:"clock-nine",kind:"folder",uid:"__recent",itemsUIDs:h}),ae.contextSrv.isSignedIn){const g=await(0,Ma.i)().get("api/user/stars");g.length>0&&m.unshift({title:"Starred",icon:"star",kind:"folder",uid:"__starred",itemsUIDs:g})}}return m},[]),u=()=>d.loading?t.createElement(Se.$,{className:i.spinner}):d.value?d.value.map(m=>t.createElement("div",{"data-testid":re.wl.components.Search.sectionV2,className:i.section,key:m.title},m.title&&t.createElement(ot,{selection:e,selectionToggle:a,onTagSelected:s,section:m,tags:r,onClickItem:o}))):t.createElement(rt.b,{className:i.error,title:d.error?d.error.message:"Something went wrong"});return t.createElement("div",{className:i.wrapper},u())},xa=e=>({wrapper:(0,l.css)`
      display: flex;
      flex-direction: column;
      overflow: auto;

      > ul {
        list-style: none;
      }

      border: solid 1px ${e.v1.colors.border2};
    `,section:(0,l.css)`
      display: flex;
      flex-direction: column;
      background: ${e.v1.colors.panelBg};

      &:not(:last-child) {
        border-bottom: solid 1px ${e.v1.colors.border2};
      }
    `,spinner:(0,l.css)`
      align-items: center;
      display: flex;
      justify-content: center;
      min-height: 100px;
    `,error:(0,l.css)`
      margin: ${e.spacing(4)} auto;
    `}),ct=t.memo(({response:e,width:a,height:s,selection:r,selectionToggle:c,onTagSelected:o,keyboardEvents:i,onClickItem:d})=>{const u=(0,p.wW)(Ta),m=(0,t.useRef)(null),[h,g]=(0,t.useState)(null),S=(0,Le.v)(i,0,e);(0,t.useEffect)(()=>{m.current&&m.current.resetloadMoreItemsCache(),h&&h.scrollTo(0)},[e,h]);const M=(0,t.useCallback)(({index:f,style:E})=>{let v="";f===S.y&&(v+=" "+u.selectedRow);const y=e.view.get(f),C=(0,te.f9)(y,e.view),L=c&&r?.(C.kind,C.uid);return t.createElement("div",{style:E,key:y.uid,className:v,role:"row"},t.createElement(nt,{item:C,onTagSelected:o,onToggleChecked:W=>{c&&c("dashboard",W.uid)},editable:r!=null,onClickItem:d,isSelected:L}))},[e.view,S,u,o,r,c,d]);return e.totalRows?t.createElement("div",{"aria-label":"Search results list",style:{width:a},role:"list"},t.createElement(ze.Z,{ref:m,isItemLoaded:e.isItemLoaded,itemCount:e.totalRows,loadMoreItems:e.loadMoreItems},({onItemsRendered:f,ref:E})=>t.createElement(ke.t7,{ref:v=>{E(v),g(v)},onItemsRendered:f,height:s,itemCount:e.totalRows,itemSize:72,width:"100%",style:{overflow:"hidden auto"}},M))):t.createElement("div",{className:u.noData,style:{width:a}},"No data")});ct.displayName="SearchResultsCards";const Ta=e=>({noData:(0,l.css)`
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
    `,selectedRow:(0,l.css)`
      border-left: 3px solid ${e.colors.primary.border};
    `}),Aa=({showManage:e,folderDTO:a,hidePseudoFolders:s,keyboardEvents:r})=>{const c=(0,p.wW)(Fa),o=ue(),i=o.useState(),[d,u]=(0,t.useState)(na()),m=We(i),h=m===w.A.Folders,[g,S]=(0,t.useState)(Date.now());(0,aa.Z)(o.onReportSearchUsage,1e3,[]);const M=(0,t.useCallback)(()=>{d.items.clear(),u({...d})},[d]),f=(0,t.useCallback)((y,C)=>{const L=d.isSelected(y,C);u(sa(d,!L,y,[C]))},[d]),E=async()=>{M(),S(Date.now()),o.onQueryChange(i.query)},v=()=>{const y=i.result;if((!y||!y.totalRows)&&!h)return i.loading&&!y?t.createElement(Se.$,null):t.createElement("div",{className:c.noResults},t.createElement("div",null,t.createElement(b.cC,{i18nKey:"search-view.no-results.text"},"No results found for your query.")),t.createElement("br",null),t.createElement(R.zx,{variant:"secondary",onClick:o.onClearSearchAndFilters},t.createElement(b.cC,{i18nKey:"search-view.no-results.clear"},"Clear search and filters")));const C=e?d.isSelected:void 0;return m===w.A.Folders?a?t.createElement(ot,{section:La(a),selection:C,selectionToggle:f,onTagSelected:o.onAddTag,renderStandaloneBody:!0,tags:i.tag,key:g,onClickItem:o.onSearchItemClicked}):t.createElement(Ia,{key:g,selection:C,selectionToggle:f,tags:i.tag,onTagSelected:o.onAddTag,hidePseudoFolders:s,onClickItem:o.onSearchItemClicked}):t.createElement("div",{style:{height:"100%",width:"100%"}},t.createElement(D.Z,null,({width:L,height:W})=>{const z={response:y,selection:C,selectionToggle:f,clearSelection:M,width:L,height:W,onTagSelected:o.onAddTag,keyboardEvents:r,onDatasourceChange:i.datasource?o.onDatasourceChange:void 0,onClickItem:o.onSearchItemClicked};return L<800?t.createElement(ct,{...z}):t.createElement(_e.Q,{...z})}))};return a&&!x.config.featureToggles.nestedFolders&&!i.loading&&!i.result?.totalRows&&!o.hasSearchFilters()?t.createElement(Ke.Z,{title:"This folder doesn't have any dashboards yet",buttonIcon:"plus",buttonTitle:"Create Dashboard",buttonLink:`dashboard/new?folderUid=${a.uid}`,proTip:"Add/move dashboards to your folder at ->",proTipLink:"dashboards",proTipLinkTitle:"Manage dashboards",proTipTarget:""}):t.createElement(t.Fragment,null,d.items.size>0?t.createElement(Da,{items:d.items,onChange:E,clearSelection:M}):t.createElement(Ie,{onLayoutChange:o.onLayoutChange,showStarredFilter:s,onStarredFilterChange:s?o.onStarredFilterChange:void 0,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,getTagOptions:o.getTagOptions,getSortOptions:(0,U.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,U.getGrafanaSearcher)().sortPlaceholder,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,state:i,includePanels:i.includePanels,onSetIncludePanels:o.onSetIncludePanels}),v())},Fa=e=>({searchInput:(0,l.css)`
    margin-bottom: 6px;
    min-height: ${e.spacing(4)};
  `,unsupported:(0,l.css)`
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 18px;
  `,noResults:(0,l.css)`
    padding: ${e.v1.spacing.md};
    background: ${e.v1.colors.bg2};
    font-style: italic;
    margin-top: ${e.v1.spacing.md};
  `});function La(e){return{uid:e.uid,kind:"folder",title:e.title}}const Oa=({folder:e,canCreateFolders:a=!1,canCreateDashboards:s=!1})=>{const[r,c]=(0,t.useState)(!1),o=x.config.featureToggles.nestedFolders&&(e?.canSave??!1),i=(0,t.useMemo)(()=>new Map([["folder",new Set(e?.uid?[e.uid]:[])]]),[e]),d=m=>{let h=`dashboard/${m}`;return m==="new_folder"&&(h="dashboards/folder/new/"),e?.uid&&(h+=`?folderUid=${e.uid}`),h},u=()=>t.createElement(me.v,null,s&&t.createElement(me.v.Item,{url:d("new"),label:Ee(),onClick:()=>(0,G.ff)("grafana_menu_item_clicked",{url:d("new"),from:"/dashboards"})}),a&&(x.config.featureToggles.nestedFolders||!e?.uid)&&t.createElement(me.v.Item,{url:d("new_folder"),label:he(),onClick:()=>(0,G.ff)("grafana_menu_item_clicked",{url:d("new_folder"),from:"/dashboards"})}),s&&t.createElement(me.v.Item,{url:d("import"),label:pe(),onClick:()=>(0,G.ff)("grafana_menu_item_clicked",{url:d("import"),from:"/dashboards"})}));return t.createElement(t.Fragment,null,t.createElement("div",null,t.createElement(oe.Lh,null,o&&t.createElement(R.zx,{onClick:()=>c(!0),icon:"exchange-alt",variant:"secondary"},"Move"),t.createElement(qe.L,{overlay:u,placement:"bottom-start"},t.createElement(R.zx,{variant:"primary"},ye(),t.createElement(Y.J,{name:"angle-down"}))))),o&&r&&t.createElement(lt,{onMoveItems:()=>{},results:i,onDismiss:()=>c(!1)}))},it=t.memo(({folder:e})=>{const a=(0,p.wW)(Ra),s=ue(),r=s.useState(),{onKeyDown:c,keyboardEvents:o}=(0,Le.A)(),i=e?.uid,d=e?.canSave,{isEditor:u}=ae.contextSrv,m=e?d:ae.contextSrv.hasEditPermissionInFolders,h=ae.contextSrv.hasAccess(I.AccessControlAction.FoldersCreate,u),g=m||!!d,S=i?ae.contextSrv.hasAccessInMetadata(I.AccessControlAction.DashboardsCreate,e,g):ae.contextSrv.hasAccess(I.AccessControlAction.DashboardsCreate,g),M=e===void 0&&h||S;return(0,t.useEffect)(()=>s.initStateFromUrl(e?.uid),[e?.uid,s]),t.createElement(t.Fragment,null,t.createElement("div",{className:(0,l.cx)(a.actionBar,"page-action-bar")},t.createElement("div",{className:(0,l.cx)(a.inputWrapper,"gf-form gf-form--grow m-r-2")},t.createElement(O.H,{value:r.query??"",onChange:f=>s.onQueryChange(f),onKeyDown:c,autoFocus:!0,spellCheck:!1,placeholder:ve(r.includePanels),escapeRegex:!1,className:a.searchInput})),M&&t.createElement(Oa,{folder:e,canCreateFolders:h,canCreateDashboards:S})),t.createElement(Aa,{showManage:!!(u||m||d),folderDTO:e,hidePseudoFolders:!0,keyboardEvents:o}))});it.displayName="ManageDashboardsNew";const Na=it,Ra=e=>({actionBar:(0,l.css)`
    ${e.breakpoints.down("sm")} {
      flex-wrap: wrap;
    }
  `,inputWrapper:(0,l.css)`
    ${e.breakpoints.down("sm")} {
      margin-right: 0 !important;
    }
  `,searchInput:(0,l.css)`
    margin-bottom: 6px;
    min-height: ${e.spacing(4)};
  `,unsupported:(0,l.css)`
    padding: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-size: 18px;
  `,noResults:(0,l.css)`
    padding: ${e.v1.spacing.md};
    background: ${e.v1.colors.bg2};
    font-style: italic;
    margin-top: ${e.v1.spacing.md};
  `}),Ne=(0,t.memo)(e=>x.config.featureToggles.nestedFolders?t.createElement(_t,{...e}):t.createElement(dt,{...e}));Ne.displayName="DashboardListPageFeatureToggle";const dt=(0,t.memo)(({match:e,location:a})=>{const{loading:s,value:r}=(0,B.Z)(()=>{const c=e.params.uid,o=a.pathname;return!c||!o.startsWith("/dashboards")?Promise.resolve({}):ta(c).then(({folder:i,folderNav:d})=>{const u=V.u.stripBaseFromUrl(i.url);return u!==a.pathname&&A.E1.replace(u),{folder:i,pageNav:d}})},[e.params.uid]);return t.createElement(P.T,{navId:"dashboards/browse",pageNav:r?.pageNav},t.createElement(P.T.Contents,{isLoading:s,className:(0,l.css)`
          display: flex;
          flex-direction: column;
          height: 100%;
        `},t.createElement(Na,{folder:r?.folder})))});dt.displayName="DashboardListPage";const $a=Ne},46430:(ne,K,n)=>{n.d(K,{Jy:()=>V,Nw:()=>A,OY:()=>B,Qw:()=>t,TP:()=>x});var l=n(86312);const t=(D,p)=>{(0,l.ff)(`${D}_viewed`,P(p))},B=(D,p)=>{(0,l.ff)(`${D}_result_clicked`,P(p))},V=(D,p)=>{(0,l.ff)(`${D}_query_submitted`,P(p))},x=(D,{error:p,...O})=>{(0,l.ff)(`${D}_query_failed`,{...P(O),error:p})},A=(D,p,O)=>{(0,l.ff)(`grafana_panel_inspect_${D}_${p}_clicked`,O)},P=D=>({layout:D.layout,starredFilter:D.starred??!1,sort:D.sortValue??"",tagCount:D.tagCount??0,queryLength:D.query?.length??0,includePanels:D.includePanels??!1})}}]);

//# sourceMappingURL=DashboardListPage.3349fe6822f17da21ff9.js.map